var elem=document.getElementById("gameContainerDiv");myGamePieceLife=100,obsCount=0;var newGamePiece="newGamePieceFirst";function openFullscreen(e){(elem=document.getElementById("gameContainerDiv")).requestFullscreen?elem.requestFullscreen():elem.webkitRequestFullScreen?elem.webkitRequestFullScreen():elem.msRequestFullscreen&&elem.msRequestFullscreen(),selectAvatar(e)}function loadGame(){document.ondblclick=null,clearIntrvlTime=20,myObstacles=[],score=0,myGameArea.start()}function restart(){document.onkeydown=null,document.onkeyup=null,clearIntrvlTime=20,obsCount=0,myObstacles=[],score=0,myGamePieceLife=100,myGameArea.start(),startGame()}function startGame(){document.getElementById("bkgrndAudio").play(),document.getElementById("startMsgDiv").style.display="none",document.getElementById("startBtn").style.display="none",document.getElementById("restartBtn").style.display="none",document.getElementById("attackBtn").style.display="block";for(var e=0;e<4;e++)createNewObstacle(e);myObstacles[4]=new componentObstacle(41,41,myGameArea.canvas.width,myGameArea.canvas.height/2,5,0,1,!0)}window.addEventListener("orientationchange",function(e){switch(window.orientation){case-90:case 90:window.location.reload()}});var myGameArea={canvas:document.getElementById("mainFrame"),start:function(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.context=this.canvas.getContext("2d"),this.frameNo=0,this.interval=setInterval(updateGameArea,clearIntrvlTime),this.interval2=setInterval(newAttack,5e3)},clear:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},stop:function(){clearInterval(this.interval),clearInterval(this.interval2)}};function newAttack(){var e=getRandomInt(1,4),t=2<e?1:2;e+=.5,0<obsCount&&(myObstacles[4]=new componentObstacle(41,41,myGameArea.canvas.width,myGameArea.canvas.height/e+20,5,0,t,!0))}function selectAvatar(e){newGamePiece="first"==e?(document.getElementById("newGamePieceFirst").style.display="block","newGamePieceFirst"):(document.getElementById("newGamePieceSecond").style.display="block","newGamePieceSecond"),(dragItem=document.getElementById(newGamePiece)).style.left="0px",dragItem.style.top="0px",document.getElementById("overlayDiv").style.display="none",0==obsCount&&(document.getElementById("startMsgDiv").style.display="block",document.getElementById("startBtn").style.display="block")}function getSrcStr(e,t){var n="images/png/";return n+="Weapon",n+=1==t?"Left.png":"Right.png"}function componentObstacle(e,t,n,a,i,s,c,r){this.id="myObstacle"+obsCount,obsCount++,this.attack=r;r="images/png/ObsNew";obsCount%2==0?r+="Violet":r+="Green",r+=".png",this.image=new Image,this.image.src=r,this.leftOrRight=c,this.width=e,this.height=t,this.speedX=i,this.speedY=s,this.x=n,this.y=a,1==this.attack&&(1==this.leftOrRight?(this.x=myGameArea.canvas.width,this.speedX=-4,this.image.src="images/png/ObsRedLeft.png"):(this.x=0,this.speedX=4,this.image.src="images/png/ObsRedRight.png"),this.speedY=0),this.update=function(e){ctx=myGameArea.context,e=1==e&&-1==this.image.src.indexOf("Defend")&&-1==this.image.src.indexOf("Red")?this.image.src.replace("ObsNew","ObsNewDefend"):this.image.src,this.image.src=e,this.x<0||this.x>myGameArea.canvas.width?(this.id.substr(10,this.id.length),this.updateCompPos()):ctx.drawImage(this.image,this.x,this.y,this.width,this.height)},this.updateCompPos=function(){getRandomInt(2,5);var e=getRandomInt(2,8);5<e&&(newRandXPos=100*e,s=1,c=i=2),e<=5&&(newRandXPos=myGameArea.canvas.width,i=-2,c=s=1),newRandXPos>myGameArea.canvas.width&&(newRandXPos=Math.abs(myGameArea.canvas.width-newRandXPos)),this.x=newRandXPos,this.y=0,this.speedX=i,this.speedY=s,this.leftOrRight=c,this.width=81,this.height=81;e="images/png/ObsNew";e+=this.id.substr(10,this.id.length)%2==0?"Violet":"Green",e+=".png",this.image.src=e},this.changeImg=function(e){var t;0==e&&-1!=this.image.src.indexOf("Defend")&&(t=this.image.src.replace("ObsNewDefend","ObsNew")),this.image.src=t},this.grow=function(){ctx=myGameArea.context,ctx.drawImage(this.image,this.x-50,this.y-50,this.width+50,this.height+50)},this.newPos=function(){this.x+=this.speedX,this.y+=this.speedY},this.shrink=function(){this.width<=20?(this.id.substr(10,this.id.length),this.updateCompPos(),score+=5):(this.width=this.width-20,this.height=this.height-20,this.x=this.x+10,this.y=this.y+10)}}function getRandomInt(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function createNewObstacle(e){getRandomInt(2,4);var t,n,a,i=getRandomInt(2,10);5<i&&(a=100*i,speedY=1,n=t=2),i<=5&&(a=myGameArea.canvas.width,t=-2,speedY=-1,n=1),a>myGameArea.canvas.width&&(a=Math.abs(myGameArea.canvas.width-a)),myObstacles[e]=new componentObstacle(81,81,a,0,t,speedY,n,!1)}function updateGameArea(){ctx=myGameArea.context,myGameArea.clear(),myObstacles.forEach(function(e,t,n){n[t].newPos(),n[t].update(!1),ctx.font="1em Comic Sans MS",ctx.fillStyle="YELLOW",ctx.textAlign="center",ctx.fillText("SCORE : "+score,myGameArea.canvas.width-100,30),ctx.fillText("Sanitiser level : ",130,30),60<myGamePieceLife?(ctx.fillStyle="#28a745",ctx.fillRect(200,20,100,10)):20<myGamePieceLife?(ctx.fillStyle="#ffc107",ctx.fillRect(200,20,50,10),ctx.fillStyle="#b7c0b9",ctx.fillRect(250,20,50,10)):(ctx.fillStyle="#dc3545",ctx.fillRect(200,20,25,10),ctx.fillStyle="#b7c0b9",ctx.fillRect(225,20,75,10))});var e=document.getElementById(newGamePiece).style.left,e=parseInt(e.substr(0,e.length-2)),t=document.getElementById(newGamePiece).style.top,t=parseInt(t.substr(0,t.length-2)),a=e,i=t+20;myObstacles.forEach(function(e,t,n){(0<obsCount&&1<n[t].height&&0==n[t].attack&&(n[t].x>a||n[t].x+81>a)&&n[t].x<a+50&&(n[t].y>i||n[t].y+81>i)&&n[t].y<i+110||1==n[t].attack&&(n[t].x>a||n[t].x+31>a)&&n[t].x<a+40&&(n[t].y>i||n[t].y+41>i)&&n[t].y<i+110||myGamePieceLife<=0)&&(document.onkeydown=null,document.onkeyup=null,myGameArea.clear(),document.getElementById("bkgrndAudio").pause(),document.getElementById("gameOverAudio").play(),myGamePieceLife<=0&&(ctx.font="1em Comic Sans MS",ctx.fillStyle="red",ctx.textAlign="center",ctx.fillText("Sanitiser exhausted",myGameArea.canvas.width/2,40)),ctx.font="1.2em Comic Sans MS",ctx.fillStyle="green",ctx.fillText("You scored "+score+" points",myGameArea.canvas.width/2,60),document.getElementById("restartBtn").style.display="block",document.getElementById("attackBtn").style.display="none",myGameArea.stop())})}var dragItem=document.getElementById(newGamePiece);dragItem.style.left="0px";var currentX,currentY,initialX,initialY,active=!(dragItem.style.top="0px"),xOffset=0,yOffset=0;function dragStart(e){initialY="touchstart"===e.type?(initialX=e.touches[0].clientX-xOffset,e.touches[0].clientY-yOffset):(initialX=e.clientX-xOffset,e.clientY-yOffset),e.target===dragItem&&(active=!0)}function dragEnd(e){initialX=currentX,initialY=currentY,dragItem.style.left=currentX+"px",dragItem.style.top=currentY+"px",active=!1}function drag(e){active&&(e.preventDefault(),currentY="touchmove"===e.type?(currentX=e.touches[0].clientX-initialX,e.touches[0].clientY-initialY):(currentX=e.clientX-initialX,e.clientY-initialY),currentX<0?currentX=0:currentX>myGameArea.canvas.width-60&&(currentX=myGameArea.canvas.width-60),currentY<0?currentY=0:currentY>myGameArea.canvas.height-110&&(currentY=myGameArea.canvas.height-110),setTranslate(xOffset=currentX,yOffset=currentY,dragItem)),dragItem.style.left=currentX+"px",dragItem.style.top=currentY+"px"}function setTranslate(e,t,n){n.style.transform="translate3d("+e+"px, "+t+"px, 0)"}function drawLinesToAttack(){var e=document.getElementById(newGamePiece).style.left,e=parseInt(e.substr(0,e.length-2)),t=document.getElementById(newGamePiece).style.top,n=e,e=t=parseInt(t.substr(0,t.length-2)),t=new Image;t.src="images/png/yellowSpray.png",ctx.drawImage(t,n+60,e-25,100,100)}function attackObstacle(){var e=document.getElementById(newGamePiece).style.left,e=parseInt(e.substr(0,e.length-2)),t=document.getElementById(newGamePiece).style.top,t=parseInt(t.substr(0,t.length-2)),a=e,i=t;myGamePieceLife--,ctx=myGameArea.context,ctx.beginPath(),ctx.strokeStyle="WHITE",ctx.setLineDash([5,3]),clearIntrvlTime=1e3,drawLinesToAttack(),myObstacles.forEach(function(e,t,n){n[t].x>a&&n[t].x-a<220&&Math.abs(n[t].y-i)<130&&(n[t].update(!0),n[t].shrink(),document.getElementById("shrinkObstacle").play())}),clearIntrvlTime=20}function clearmove(){myGamePiece.speedX=0,myGamePiece.speedY=0}